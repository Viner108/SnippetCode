Лекция 06 Физическая структура данных
Табличные пространства в Postgres Pro позволяют администраторам организовать логику размещения файлов объектов базы
данных в файловой системе. К однажды созданному табличному пространству можно обращаться по имени на этапе создания
объектов.
Каждое табличное пространстрво это по сути дела указатель на каталог в файловой системе.
В каталоге PGDATA содержится несколько подкаталогов и управляющих файлов.

Каждое табличное и индексное отношение, за исключением хеш-индексов, имеет карту свободного пространства (Free Space Map,
FSM) для отслеживания доступного места. Она хранится рядом с данными главного отношения в отдельном слое, имя которого
образуется номером файлового узла отношения с суффиксом _fsm.
Карта свободного пространства представляет собой дерево страниц FSM. Страницы FSM нижнего уровня хранят информацию о
свободном пространстве, доступном на каждой странице таблицы (или индекса), используя один байт для представления каждой
такой страницы. Верхние уровни агрегируют информацию нижних уровней.
Каждое отношение таблицы имеет карту видимости (Visibility Map, VM) для отслеживания страниц, содержащих только строки,
которые видны всем активным транзакциям; в ней также отслеживается, какие страницы содержат только замороженные строки.
Она хранится вместе с данными главного отношения в отдельном файле, имя которого образуется номером файлового узла
отношения с суффиксом _vm.
Карта видимости хранит по два бита на страницу таблицы. Первый бит, если он установлен, показывает, что вся страница
видна или, другими словами, не содержит строк, которые необходимо очистить. Эта информация может также использоваться
при сканировании только индекса для поиска ответов только в данных индекса. Установленный второй бит показывает, что все
строки на этой странице заморожены. Это означает, что процесс очистки для предотвращения зацикливания не должен больше
посещать эту страницу.

PostgreSQL использует фиксированный размер страницы (обычно 8 КБ), и не позволяет строкам занимать несколько страниц.
Поэтому непосредственно хранить очень большие значения полей невозможно. Для преодоления этого ограничения большие
значения полей сжимаются и/или разбиваются на несколько физических строк. Это происходит незаметно для пользователя и на
большую часть кода сервера влияет незначительно. Этот метод известен как TOAST.

Лекция 05 Логическая структура данных
Кластер баз данных PostgreSQL содержит один или несколько именованных экземпляров баз. На уровне кластера создаются роли
и некоторые другие объекты. База данных содержит одну или несколько именованных схем, которые в свою очередь содержат
таблицы.
Схема - это пространство имен для объектов, разделяющее объекты на логические группы и предотвращающее конфликты имен
между приложениями.
К таблицам обычно обращаются по неполному имени, состоящему просто из имени таблицы. Система определяет, какая именно
таблица подразумевается, используя путь поиска, который представляет собой список просматриваемых схем. Подразумеваемой
таблицей считается первая подходящая таблица, найденная в схемах пути. Если подходящая таблица не найдена, возникает
ошибка, даже если таблица с таким именем есть в других схемах базы данных.